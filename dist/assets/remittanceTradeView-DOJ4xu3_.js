import{a5 as ie,a6 as de,_ as ce,r as v,z as fe,c as y,b as l,w as t,a0 as $,e as d,a7 as pe,a4 as p,F as O,o,a1 as r,a8 as be,a as n,a3 as w,u as P,B as h,V as B,t as b}from"./index-Dfpqkfnz.js";import{V as Ve,a as ye,b as Ne,c as D,d as _e}from"./VStepper-BAqcIdQo.js";import{V as I,b as Y}from"./VCard-DECbdgiQ.js";import{V as R}from"./VForm-BcN4j-94.js";import{V as q}from"./VContainer-Dm2e2qJ9.js";import{V as J}from"./VTextField-B9oVOGi3.js";import{V as F}from"./VSelect-BbFokLe7.js";import"./VAvatar-CthOB--A.js";import"./VImg-C-fKbzw8.js";import"./VWindowItem-D4JbBMjf.js";import"./ssrBoot-BEGXEBRu.js";import"./form-D43RqBoT.js";import"./index--CYg-LPA.js";import"./VMenu-CbC_0wyS.js";const G=de(),z=ie.create({baseURL:"https://gateway.khaneetala.ir/v1/remmitance",headers:{"Content-Type":"application/json",Accept:"application/json"}});z.interceptors.request.use(m=>{const f=localStorage.getItem("token");return f?m.headers.Authorization=`Bearer ${f}`:G.replace("/login"),m},m=>Promise.reject(m));z.interceptors.response.use(m=>m,m=>(m.response.status==401&&(localStorage.removeItem("token"),G.replace("/login")),console.error("API Error:",m.response||m.message),Promise.reject(m)));const W={async AuthNumberRemiitance(m){const f=JSON.stringify({phoneNumber:m});return(await z.post("/users/check",f)).data},async AuthIdentityUser(m){const f=JSON.stringify({phoneNumber:m.phoneNumber,birthDate:m.birthDate,nationalCode:m.nationalCode});return(await z.post("/users/newuser",f)).data}},ke={class:"w-100 d-flex justify-space-between align-items-center"},ge={key:0,class:"d-flex"},he={key:1,class:"d-flex"},xe={key:1,class:"d-flex"},Ce={class:"mb-0"},Se={class:"d-flex"},we={class:"mb-0"},Be={class:"d-flex"},De={class:"mb-0"},Ie={class:"d-flex"},Re={key:0,class:"mb-0"},ze={key:1,class:"mb-0"},Ae={class:"d-flex"},Te={class:"mb-0"},Ue={class:"d-flex"},He={class:"mb-0"},$e={class:"d-flex"},Fe={class:"mb-0"},Ee={class:"d-flex"},je={class:"mb-0"},Le={class:"d-flex"},Me={__name:"remittanceTradeView",setup(m){const f=v([1,2,3,4]),i=v(1),x=v({}),A=v(!1),C=v(!1),N=v(),_=v(),k=v(),g=v(!1),T=v(""),V=v({phoneNumber:""}),u=v({id:"",firstName:"",birthDate:"",lastName:"",fatherName:"",gender:"",officeName:"",phoneNumber:"",nationalCode:"",isHaveBank:""}),c=v({userExist:"",userVerified:""}),K=v([{name:"1",value:1},{name:"2",value:2},{name:"3",value:3},{name:"4",value:4},{name:"5",value:5},{name:"6",value:6},{name:"7",value:7},{name:"8",value:8},{name:"9",value:9},{name:"10",value:10},{name:"11",value:11},{name:"12",value:12},{name:"13",value:13},{name:"14",value:14},{name:"15",value:15},{name:"16",value:16},{name:"17",value:17},{name:"18",value:18},{name:"19",value:19},{name:"20",value:20},{name:"21",value:21},{name:"22",value:22},{name:"23",value:23},{name:"24",value:24},{name:"25",value:25},{name:"26",value:26},{name:"27",value:27},{name:"28",value:28},{name:"29",value:29},{name:"30",value:30},{name:"31",value:31}]),Q=v([{name:"فروردین",value:1},{name:"اردیبهشت",value:2},{name:"خرداد",value:3},{name:"تیر",value:4},{name:"مرداد",value:5},{name:"شهریور",value:6},{name:"مهر",value:7},{name:"آبان",value:8},{name:"آذر",value:9},{name:"دی",value:10},{name:"بهمن",value:11},{name:"اسفند",value:12}]),X=v([{name:"1300",value:1300},{name:"1301",value:1301},{name:"1302",value:1302},{name:"1303",value:1303},{name:"1304",value:1304},{name:"1305",value:1305},{name:"1306",value:1306},{name:"1307",value:1307},{name:"1308",value:1308},{name:"1309",value:1309},{name:"1310",value:1310},{name:"1311",value:1311},{name:"1312",value:1312},{name:"1313",value:1313},{name:"1314",value:1314},{name:"1315",value:1315},{name:"1316",value:1316},{name:"1317",value:1317},{name:"1318",value:1318},{name:"1319",value:1319},{name:"1320",value:1320},{name:"1321",value:1321},{name:"1322",value:1322},{name:"1323",value:1323},{name:"1324",value:1324},{name:"1325",value:1325},{name:"1326",value:1326},{name:"1327",value:1327},{name:"1328",value:1328},{name:"1329",value:1329},{name:"1330",value:1330},{name:"1331",value:1331},{name:"1332",value:1332},{name:"1333",value:1333},{name:"1334",value:1334},{name:"1335",value:1335},{name:"1336",value:1336},{name:"1337",value:1337},{name:"1338",value:1338},{name:"1339",value:1339},{name:"1340",value:1340},{name:"1341",value:1341},{name:"1342",value:1342},{name:"1343",value:1343},{name:"1344",value:1344},{name:"1345",value:1345},{name:"1346",value:1346},{name:"1347",value:1347},{name:"1348",value:1348},{name:"1349",value:1349},{name:"1350",value:1350},{name:"1351",value:1351},{name:"1352",value:1352},{name:"1353",value:1353},{name:"1354",value:1354},{name:"1355",value:1355},{name:"1356",value:1356},{name:"1357",value:1357},{name:"1358",value:1358},{name:"1359",value:1359},{name:"1360",value:1360},{name:"1361",value:1361},{name:"1362",value:1362},{name:"1363",value:1363},{name:"1364",value:1364},{name:"1365",value:1365},{name:"1366",value:1366},{name:"1367",value:1367},{name:"1368",value:1368},{name:"1369",value:1369},{name:"1370",value:1370},{name:"1371",value:1371},{name:"1372",value:1372},{name:"1373",value:1373},{name:"1374",value:1374},{name:"1375",value:1375},{name:"1376",value:1376},{name:"1377",value:1377},{name:"1378",value:1378},{name:"1379",value:1379},{name:"1380",value:1380},{name:"1381",value:1381},{name:"1382",value:1382},{name:"1383",value:1383},{name:"1384",value:1384},{name:"1385",value:1385},{name:"1386",value:1386},{name:"1387",value:1387},{name:"1388",value:1388},{name:"1389",value:1389},{name:"1390",value:1390},{name:"1391",value:1391},{name:"1392",value:1392},{name:"1393",value:1393},{name:"1394",value:1394},{name:"1395",value:1395},{name:"1396",value:1396},{name:"1397",value:1397},{name:"1398",value:1398},{name:"1399",value:1399},{name:"1400",value:1400},{name:"1401",value:1401},{name:"1402",value:1402},{name:"1403",value:1403}]),U=a=>a<i.value,E=fe(()=>x.value[i.value]?x.value[i.value].isValid:!1),S=(a,e)=>{a&&(x.value[e]=a)},j=async a=>{const e=x.value[i.value];if(e){const{valid:s}=await e.validate();s&&await Z()&&i.value++}},Z=async a=>{if(i.value===1)return await ee();if(i.value===2)return!0;if(i.value===3)return!0;if(i.value===4)return!0},ee=async()=>{try{A.value=!0;const a=await W.AuthNumberRemiitance(V.value.phoneNumber);return c.value.userExist=a.data.userExist,c.value.userVerified=a.data.userVerified,u.value.id=a.data.user.id,u.value.firstName=a.data.user.firstName,u.value.lastName=a.data.user.lastName,u.value.fatherName=a.data.user.fatherName,u.value.gender=a.data.user.gender,u.value.officeName=a.data.user.officeName,u.value.phoneNumber=a.data.user.phoneNumber,u.value.nationalCode=a.data.user.nationalCode,u.value.isHaveBank=a.data.user.isHaveBank,u.value.birthDate=a.data.user.birthDate,console.log(u.value),a}catch(a){T.value=a.response.data.error||"خطایی رخ داده است!",g.value=!0,setTimeout(()=>{g.value=!1},1e4)}finally{A.value=!1}},ae=async()=>{try{C.value=!0,u.value.phoneNumber=V.value.phoneNumber,console.log(u.value);const a=await W.AuthIdentityUser(u.value);return u.value.fatherName=a.data.fatherName,u.value.gender=a.data.gender,u.value.isHaveBank=a.data.isHaveBank,u.value.officeName=a.data.officeName,u.value.firstName=a.data.firstName,u.value.lastName=a.data.lastName,c.value.userVerified=!0,console.log(u.value),a}catch(a){T.value=a.response.data.error||"خطایی رخ داده است!",g.value=!0,setTimeout(()=>{g.value=!1},1e4)}finally{C.value=!1}},le=()=>{i.value>1&&i.value--,N.value="",_.value="",k.value="",u.value.nationalCode=""},te=[a=>!!a||"شماره همراه الزامی است",a=>/^09\d{9}$/.test(a)||"شماره معتبر نیست"],L=[a=>!!a||"کد ملی الزامی است",a=>/^\d{10}$/.test(a)||"کد ملی باید ۱۰ رقم باشد",a=>{if(!/^\d{10}$/.test(a))return!0;const e=+a[9],s=a.split("").slice(0,9).reduce((M,me,ve)=>M+ +me*(10-ve),0)%11;return s<2&&e===s||s>=2&&e+s===11||"کد ملی نامعتبر است"}],se=()=>{u.value.nationalCode=u.value.nationalCode.replace(/\D/g,"").slice(0,10),L.every(a=>a(u.value.nationalCode)===!0)},ue=()=>{V.value.phoneNumber=V.value.phoneNumber.replace(/\D/g,"").slice(0,11)},ne=a=>{N.value=a,H()},oe=a=>{_.value=a,H()},re=a=>{k.value=a,H()},H=()=>{if(k.value&&_.value&&N.value){const a=String(_.value).padStart(2,"0"),e=String(N.value).padStart(2,"0");u.value.birthDate=`${k.value}${a}${e}`}};return(a,e)=>(o(),y(O,null,[l($,null,{default:t(()=>[l(r,{cols:"12"},{default:t(()=>[l(Ve,{modelValue:i.value,"onUpdate:modelValue":e[5]||(e[5]=s=>i.value=s)},{default:t(()=>[l(ye,null,{default:t(()=>[(o(!0),y(O,null,be(f.value,s=>(o(),d(_e,{key:s,complete:U(s),title:`مرحله ${s}`,value:s,icon:U(s)?"ri-check-line":"ri-close-line",color:U(s)?"#0b8707":"#c7c3c3",class:"custom-stepper-icon"},null,8,["complete","title","value","icon","color"]))),128))]),_:1}),l(Ne,null,{default:t(()=>[l(D,{value:1},{default:t(()=>[l(I,{class:"step-card"},{default:t(()=>[l(R,{ref:s=>S(s,1)},{default:t(()=>[l(q,null,{default:t(()=>[l($,null,{default:t(()=>[l(r,{cols:"12"},{default:t(()=>e[6]||(e[6]=[n("div",{class:"d-flex"},[n("h3",{class:"trade-step-title"},"احراز هویت")],-1)])),_:1}),l(r,{cols:"12",md:"4",class:"d-none d-md-flex"}),l(r,{cols:"12",md:"4"},{default:t(()=>[l(J,{modelValue:V.value.phoneNumber,"onUpdate:modelValue":e[0]||(e[0]=s=>V.value.phoneNumber=s),label:"شماره همراه",variant:"outlined",rules:te,onInput:ue},null,8,["modelValue"])]),_:1}),l(r,{cols:"12",md:"4",class:"d-none d-md-flex"})]),_:1})]),_:1})]),_:1},512),l(Y,{class:"btn-box first-step"},{default:t(()=>[l(w,{onClick:j,color:"primary",size:"large",variant:"elevated",loading:A.value,disabled:!P(E)},{default:t(()=>e[7]||(e[7]=[h(" بعدی ")])),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1}),l(D,{value:2},{default:t(()=>[l(I,{class:"step-card"},{default:t(()=>[l(R,{ref:s=>S(s,2)},{default:t(()=>[l(q,null,{default:t(()=>[l($,null,{default:t(()=>[l(r,{cols:"12"},{default:t(()=>[n("div",ke,[e[10]||(e[10]=n("h3",{class:"trade-step-title"},"اطلاعات کاربر",-1)),c.value.userVerified?(o(),y("div",ge,[e[8]||(e[8]=n("p",{class:"mb-0"},"کاربر احراز هویت شده است",-1)),l(B,{class:"me-2",size:"small",icon:"ri-check-line",color:"#0b8707"})])):(o(),y("div",he,[e[9]||(e[9]=n("p",{class:"mb-0"},"کاربر احراز هویت نشده است",-1)),l(B,{class:"me-2",size:"small",icon:"ri-close-line",color:"#c9190c"})]))])]),_:1}),l(r,{cols:"12",md:"3",class:"my-3"},{default:t(()=>[c.value.userVerified==!1?(o(),d(J,{key:0,modelValue:u.value.nationalCode,"onUpdate:modelValue":e[1]||(e[1]=s=>u.value.nationalCode=s),label:"کد ملی",variant:"outlined",rules:L,onInput:se},null,8,["modelValue"])):(o(),y("div",xe,[e[11]||(e[11]=n("p",{class:"mb-0"},"کد ملی : ",-1)),n("p",Ce,b(u.value.nationalCode),1)]))]),_:1}),c.value.userVerified==!1?(o(),d(r,{key:0,cols:"4",md:"3",class:"my-3"})):p("",!0),c.value.userVerified==!1?(o(),d(r,{key:1,cols:"4",md:"2",class:"my-3"},{default:t(()=>[l(F,{modelValue:N.value,"onUpdate:modelValue":[e[2]||(e[2]=s=>N.value=s),ne],label:"روز تولد",items:K.value,variant:"outlined","item-title":"name","item-value":"value",class:"first-select",rules:[s=>!!s||"روز الزامی است"]},null,8,["modelValue","items","rules"])]),_:1})):p("",!0),c.value.userVerified==!1?(o(),d(r,{key:2,cols:"4",md:"2",class:"my-3"},{default:t(()=>[l(F,{modelValue:_.value,"onUpdate:modelValue":[e[3]||(e[3]=s=>_.value=s),oe],label:"ماه تولد",items:Q.value,variant:"outlined",class:"second-select","item-title":"name","item-value":"value",rules:[s=>!!s||"ماه الزامی است"]},null,8,["modelValue","items","rules"])]),_:1})):p("",!0),c.value.userVerified==!1?(o(),d(r,{key:3,cols:"4",md:"2",class:"my-3"},{default:t(()=>[l(F,{modelValue:k.value,"onUpdate:modelValue":[e[4]||(e[4]=s=>k.value=s),re],label:"سال تولد",items:X.value,variant:"outlined",class:"third-select","item-title":"name","item-value":"value",rules:[s=>!!s||"سال الزامی است"]},null,8,["modelValue","items","rules"])]),_:1})):p("",!0),c.value.userVerified==!0?(o(),d(r,{key:4,cols:"12",md:"3",class:"my-3"},{default:t(()=>[n("div",Se,[e[12]||(e[12]=n("p",{class:"mb-0"},"تاریخ تولد : ",-1)),n("p",we,b(u.value.birthDate),1)])]),_:1})):p("",!0),l(r,{cols:"12",md:"3",class:"my-3"},{default:t(()=>[n("div",Be,[e[13]||(e[13]=n("p",{class:"mb-0"},"شماره همراه : ",-1)),n("p",De,b(V.value.phoneNumber),1)])]),_:1}),l(r,{cols:"12",md:"3",class:"my-3"},{default:t(()=>[n("div",Ie,[e[14]||(e[14]=n("p",{class:"mb-0"},"جنسیت : ",-1)),u.value.gender==!0?(o(),y("p",Re,"مرد")):u.value.gender==!1?(o(),y("p",ze,"زن")):p("",!0)])]),_:1}),l(r,{cols:"12",md:"3",class:"my-3"},{default:t(()=>[n("div",Ae,[e[15]||(e[15]=n("p",{class:"mb-0"},"نام : ",-1)),n("p",Te,b(u.value.firstName),1)])]),_:1}),l(r,{cols:"12",md:"3",class:"my-3"},{default:t(()=>[n("div",Ue,[e[16]||(e[16]=n("p",{class:"mb-0"},"نام خانوادگی : ",-1)),n("p",He,b(u.value.lastName),1)])]),_:1}),l(r,{cols:"12",md:"3",class:"my-3"},{default:t(()=>[n("div",$e,[e[17]||(e[17]=n("p",{class:"mb-0"},"نام پدر : ",-1)),n("p",Fe,b(u.value.fatherName),1)])]),_:1}),l(r,{cols:"12",md:"3",class:"my-3"},{default:t(()=>[n("div",Ee,[e[18]||(e[18]=n("p",{class:"mb-0"},"شهر : ",-1)),n("p",je,b(u.value.officeName),1)])]),_:1}),l(r,{cols:"12",md:"3",class:"my-3"},{default:t(()=>[n("div",Le,[e[19]||(e[19]=n("p",{class:"mb-0"},"کارت بانکی : ",-1)),u.value.isHaveBank==!0?(o(),d(B,{key:0,size:"small",icon:"ri-close-line",color:"#c9190c"})):u.value.isHaveBank==!1?(o(),d(B,{key:1,size:"small",icon:"ri-check-line",color:"#0b8707"})):p("",!0)])]),_:1})]),_:1})]),_:1})]),_:1},512),l(Y,{class:"btn-box"},{default:t(()=>[l(w,{onClick:le,size:"large"},{default:t(()=>e[20]||(e[20]=[h("قبلی")])),_:1}),c.value.userVerified==!1?(o(),d(w,{key:0,onClick:ae,color:"primary",size:"large",variant:"elevated",disabled:!P(E),loading:C.value},{default:t(()=>e[21]||(e[21]=[h(" استعلام هویت ")])),_:1},8,["disabled","loading"])):(o(),d(w,{key:1,onClick:j,color:"primary",size:"large",variant:"elevated",loading:C.value},{default:t(()=>e[22]||(e[22]=[h(" بعدی ")])),_:1},8,["loading"]))]),_:1})]),_:1})]),_:1}),l(D,{value:3},{default:t(()=>[l(I,{class:"step-card"},{default:t(()=>[l(R,{ref:s=>S(s,3)},null,512)]),_:1})]),_:1}),l(D,{value:4},{default:t(()=>[l(I,{class:"step-card"},{default:t(()=>[l(R,{ref:s=>S(s,4)},null,512)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),g.value?(o(),d(pe,{key:0,color:"error",border:"bottom",elevation:"2",class:"k-alert alert-animatiton",closable:""},{default:t(()=>[h(b(T.value),1)]),_:1})):p("",!0)],64))}},ta=ce(Me,[["__scopeId","data-v-7678798b"]]);export{ta as default};
